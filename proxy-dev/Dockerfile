FROM alpine:3.7
# COPY ./frontends/wrap-r/bundle /frontends/wrap-r
RUN apk update && apk add nginx unzip

# https://nginxconfig.io/?0.domain=wrap-r&0.path=%2Ffrontends%2Fwrap-r&0.document_root=&0.cdn&0.https=false&0.php=false&0.proxy&0.proxy_path=%2Fapi%2Fwrap-r&0.proxy_pass=http:%2F%2Fwrapr-service:9090%2F&0.fallback_html&content_security_policy=default-src%20%27self%27%20http:%20https:%20data:%20blob:%20%27unsafe-inline%27%20%27unsafe-eval%27
# RUN echo 'UEsDBAoAAAAAAGw0ck/1335bnAMAAJwDAAAKAAAAbmdpbnguY29uZiMgR2VuZXJhdGVkIGJ5IG5naW54Y29uZmlnLmlvCiMgaHR0cHM6Ly9uZ2lueGNvbmZpZy5pby8/MC5kb21haW49d3JhcC1yJjAucGF0aD0lMkZmcm9udGVuZHMlMkZ3cmFwLXImMC5kb2N1bWVudF9yb290PSYwLmNkbiYwLmh0dHBzPWZhbHNlJjAucGhwPWZhbHNlJjAucHJveHkmMC5wcm94eV9wYXRoPSUyRmFwaSUyRndyYXAtciYwLnByb3h5X3Bhc3M9aHR0cDolMkYlMkZ3cmFwci1zZXJ2aWNlOjkwOTAlMkYmMC5mYWxsYmFja19odG1sJmNvbnRlbnRfc2VjdXJpdHlfcG9saWN5PWRlZmF1bHQtc3JjJTIwJ3NlbGYnJTIwaHR0cDolMjBodHRwczolMjBkYXRhOiUyMGJsb2I6JTIwJ3Vuc2FmZS1pbmxpbmUnJTIwJ3Vuc2FmZS1ldmFsJwoKdXNlciB3d3ctZGF0YTsKcGlkIC9ydW4vbmdpbngucGlkOwp3b3JrZXJfcHJvY2Vzc2VzIGF1dG87Cndvcmtlcl9ybGltaXRfbm9maWxlIDY1NTM1OwoKZXZlbnRzIHsKCW11bHRpX2FjY2VwdCBvbjsKCXdvcmtlcl9jb25uZWN0aW9ucyA2NTUzNTsKfQoKaHR0cCB7CgljaGFyc2V0IHV0Zi04OwoJc2VuZGZpbGUgb247Cgl0Y3Bfbm9wdXNoIG9uOwoJdGNwX25vZGVsYXkgb247CglzZXJ2ZXJfdG9rZW5zIG9mZjsKCWxvZ19ub3RfZm91bmQgb2ZmOwoJdHlwZXNfaGFzaF9tYXhfc2l6ZSAyMDQ4OwoJY2xpZW50X21heF9ib2R5X3NpemUgMTZNOwoKCSMgTUlNRQoJaW5jbHVkZSBtaW1lLnR5cGVzOwoJZGVmYXVsdF90eXBlIGFwcGxpY2F0aW9uL29jdGV0LXN0cmVhbTsKCgkjIGxvZ2dpbmcKCWFjY2Vzc19sb2cgL3Zhci9sb2cvbmdpbngvYWNjZXNzLmxvZzsKCWVycm9yX2xvZyAvdmFyL2xvZy9uZ2lueC9lcnJvci5sb2cgd2FybjsKCgkjIGxvYWQgY29uZmlncwoJaW5jbHVkZSAvZXRjL25naW54L2NvbmYuZC8qLmNvbmY7CglpbmNsdWRlIC9ldGMvbmdpbngvc2l0ZXMtZW5hYmxlZC8qOwp9ClBLAwQKAAAAAABsNHJPAAAAAAAAAAAAAAAAEAAAAHNpdGVzLWF2YWlsYWJsZS9QSwMECgAAAAAAbDRyT70Oi6gOAgAADgIAABsAAABzaXRlcy1hdmFpbGFibGUvd3JhcC1yLmNvbmZzZXJ2ZXIgewoJbGlzdGVuIDgwOwoJbGlzdGVuIFs6Ol06ODA7CgoJc2VydmVyX25hbWUgd3JhcC1yOwoJcm9vdCAvZnJvbnRlbmRzL3dyYXAtcjsKCgkjIHNlY3VyaXR5CglpbmNsdWRlIG5naW54Y29uZmlnLmlvL3NlY3VyaXR5LmNvbmY7CgoJIyBpbmRleC5odG1sIGZhbGxiYWNrCglsb2NhdGlvbiAvIHsKCQl0cnlfZmlsZXMgJHVyaSAkdXJpLyAvaW5kZXguaHRtbDsKCX0KCgkjIHJldmVyc2UgcHJveHkKCWxvY2F0aW9uIC9hcGkvd3JhcC1yIHsKCQlwcm94eV9wYXNzIGh0dHA6Ly93cmFwci1zZXJ2aWNlOjkwOTAvOwoJCWluY2x1ZGUgbmdpbnhjb25maWcuaW8vcHJveHkuY29uZjsKCX0KCgkjIGFkZGl0aW9uYWwgY29uZmlnCglpbmNsdWRlIG5naW54Y29uZmlnLmlvL2dlbmVyYWwuY29uZjsKfQoKIyBzdWJkb21haW5zIHJlZGlyZWN0CnNlcnZlciB7CglsaXN0ZW4gODA7CglsaXN0ZW4gWzo6XTo4MDsKCglzZXJ2ZXJfbmFtZSAqLndyYXAtcjsKCglyZXR1cm4gMzAxIGh0dHA6Ly93cmFwLXIkcmVxdWVzdF91cmk7Cn0KUEsDBAoAAAAAAGw0ck8AAAAAAAAAAAAAAAAOAAAAc2l0ZXMtZW5hYmxlZC9QSwMECgAAAAAAbDRyTzsM8i8eAAAAHgAAABkAAABzaXRlcy1lbmFibGVkL3dyYXAtci5jb25mLi4vc2l0ZXMtYXZhaWxhYmxlL3dyYXAtci5jb25mUEsDBAoAAAAAAGw0ck8AAAAAAAAAAAAAAAAPAAAAbmdpbnhjb25maWcuaW8vUEsDBAoAAAAAAGw0ck93D9F0mQEAAJkBAAAcAAAAbmdpbnhjb25maWcuaW8vc2VjdXJpdHkuY29uZiMgc2VjdXJpdHkgaGVhZGVycwphZGRfaGVhZGVyIFgtRnJhbWUtT3B0aW9ucyAiU0FNRU9SSUdJTiIgYWx3YXlzOwphZGRfaGVhZGVyIFgtWFNTLVByb3RlY3Rpb24gIjE7IG1vZGU9YmxvY2siIGFsd2F5czsKYWRkX2hlYWRlciBYLUNvbnRlbnQtVHlwZS1PcHRpb25zICJub3NuaWZmIiBhbHdheXM7CmFkZF9oZWFkZXIgUmVmZXJyZXItUG9saWN5ICJuby1yZWZlcnJlci13aGVuLWRvd25ncmFkZSIgYWx3YXlzOwphZGRfaGVhZGVyIENvbnRlbnQtU2VjdXJpdHktUG9saWN5ICJkZWZhdWx0LXNyYyAnc2VsZicgaHR0cDogaHR0cHM6IGRhdGE6IGJsb2I6ICd1bnNhZmUtaW5saW5lJyAndW5zYWZlLWV2YWwnIiBhbHdheXM7CgojIC4gZmlsZXMKbG9jYXRpb24gfiAvXC4oPyF3ZWxsLWtub3duKSB7CglkZW55IGFsbDsKfQpQSwMECgAAAAAAbDRyT7Nrd7m2AgAAtgIAABsAAABuZ2lueGNvbmZpZy5pby9nZW5lcmFsLmNvbmYjIGZhdmljb24uaWNvCmxvY2F0aW9uID0gL2Zhdmljb24uaWNvIHsKCWxvZ19ub3RfZm91bmQgb2ZmOwoJYWNjZXNzX2xvZyBvZmY7Cn0KCiMgcm9ib3RzLnR4dApsb2NhdGlvbiA9IC9yb2JvdHMudHh0IHsKCWxvZ19ub3RfZm91bmQgb2ZmOwoJYWNjZXNzX2xvZyBvZmY7Cn0KCiMgYXNzZXRzLCBtZWRpYQpsb2NhdGlvbiB+KiBcLig/OmNzcyhcLm1hcCk/fGpzKFwubWFwKT98anBlP2d8cG5nfGdpZnxpY298Y3VyfGhlaWN8d2VicHx0aWZmP3xtcDN8bTRhfGFhY3xvZ2d8bWlkaT98d2F2fG1wNHxtb3Z8d2VibXxtcGU/Z3xhdml8b2d2fGZsdnx3bXYpJCB7CglleHBpcmVzIDdkOwoJYWNjZXNzX2xvZyBvZmY7Cn0KCiMgc3ZnLCBmb250cwpsb2NhdGlvbiB+KiBcLig/OnN2Z3o/fHR0Znx0dGN8b3RmfGVvdHx3b2ZmMj8pJCB7CglhZGRfaGVhZGVyIEFjY2Vzcy1Db250cm9sLUFsbG93LU9yaWdpbiAiKiI7CglleHBpcmVzIDdkOwoJYWNjZXNzX2xvZyBvZmY7Cn0KCiMgZ3ppcApnemlwIG9uOwpnemlwX3Zhcnkgb247Cmd6aXBfcHJveGllZCBhbnk7Cmd6aXBfY29tcF9sZXZlbCA2OwpnemlwX3R5cGVzIHRleHQvcGxhaW4gdGV4dC9jc3MgdGV4dC94bWwgYXBwbGljYXRpb24vanNvbiBhcHBsaWNhdGlvbi9qYXZhc2NyaXB0IGFwcGxpY2F0aW9uL3Jzcyt4bWwgYXBwbGljYXRpb24vYXRvbSt4bWwgaW1hZ2Uvc3ZnK3htbDsKUEsDBAoAAAAAAGw0ck9dLhMQmwEAAJsBAAAZAAAAbmdpbnhjb25maWcuaW8vcHJveHkuY29uZnByb3h5X2h0dHBfdmVyc2lvbgkxLjE7CnByb3h5X2NhY2hlX2J5cGFzcwkkaHR0cF91cGdyYWRlOwoKcHJveHlfc2V0X2hlYWRlciBVcGdyYWRlCQkJJGh0dHBfdXBncmFkZTsKcHJveHlfc2V0X2hlYWRlciBDb25uZWN0aW9uIAkJInVwZ3JhZGUiOwpwcm94eV9zZXRfaGVhZGVyIEhvc3QJCQkJJGhvc3Q7CnByb3h5X3NldF9oZWFkZXIgWC1SZWFsLUlQCQkJJHJlbW90ZV9hZGRyOwpwcm94eV9zZXRfaGVhZGVyIFgtRm9yd2FyZGVkLUZvcgkkcHJveHlfYWRkX3hfZm9yd2FyZGVkX2ZvcjsKcHJveHlfc2V0X2hlYWRlciBYLUZvcndhcmRlZC1Qcm90bwkkc2NoZW1lOwpwcm94eV9zZXRfaGVhZGVyIFgtRm9yd2FyZGVkLUhvc3QJJGhvc3Q7CnByb3h5X3NldF9oZWFkZXIgWC1Gb3J3YXJkZWQtUG9ydAkkc2VydmVyX3BvcnQ7ClBLAQIeAwoAAAAAAGw0ck/1335bnAMAAJwDAAAKAAAAAAAAAAAAAAC0gQAAAABuZ2lueC5jb25mUEsBAh4DCgAAAAAAbDRyTwAAAAAAAAAAAAAAABAAAAAAAAAAAAAQAP1BxAMAAHNpdGVzLWF2YWlsYWJsZS9QSwECHgMKAAAAAABsNHJPvQ6LqA4CAAAOAgAAGwAAAAAAAAAAAAAAtIHyAwAAc2l0ZXMtYXZhaWxhYmxlL3dyYXAtci5jb25mUEsBAh4DCgAAAAAAbDRyTwAAAAAAAAAAAAAAAA4AAAAAAAAAAAAQAP1BOQYAAHNpdGVzLWVuYWJsZWQvUEsBAh4DCgAAAAAAbDRyTzsM8i8eAAAAHgAAABkAAAAAAAAAAAAAAO2hZQYAAHNpdGVzLWVuYWJsZWQvd3JhcC1yLmNvbmZQSwECHgMKAAAAAABsNHJPAAAAAAAAAAAAAAAADwAAAAAAAAAAABAA/UG6BgAAbmdpbnhjb25maWcuaW8vUEsBAh4DCgAAAAAAbDRyT3cP0XSZAQAAmQEAABwAAAAAAAAAAAAAALSB5wYAAG5naW54Y29uZmlnLmlvL3NlY3VyaXR5LmNvbmZQSwECHgMKAAAAAABsNHJPs2t3ubYCAAC2AgAAGwAAAAAAAAAAAAAAtIG6CAAAbmdpbnhjb25maWcuaW8vZ2VuZXJhbC5jb25mUEsBAh4DCgAAAAAAbDRyT10uExCbAQAAmwEAABkAAAAAAAAAAAAAALSBqQsAAG5naW54Y29uZmlnLmlvL3Byb3h5LmNvbmZQSwUGAAAAAAkACQBZAgAAew0AAAAA' | base64 -d > /etc/nginx/nginxconfig.io-wrap-r.zip
# RUN cd /etc/nginx && unzip -o nginxconfig.io-wrap-r.zip

COPY . /etc/nginx/

# ensure www-data user exists
RUN set -x ; \
    addgroup -g 82 -S www-data ; \
    adduser -u 82 -D -S -G www-data www-data && exit 0 ; exit 1

EXPOSE 80

CMD ["nginx", "-g", "daemon off;"]