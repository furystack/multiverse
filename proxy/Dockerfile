FROM alpine:3.7
COPY ./frontends/wrap-r/bundle /frontends/wrap-r
RUN apk update && apk add nginx unzip

# https://nginxconfig.io/?0.domain=wrap-r&0.path=%2Ffrontends%2Fwrap-r&0.document_root=&0.cdn&0.https=false&0.php=false&0.proxy&0.proxy_path=%2Fapi%2Fwrap-r&0.proxy_pass=http:%2F%2Flocalhost:9090&0.fallback_html&content_security_policy=default-src%20%27self%27%20http:%20https:%20data:%20blob:%20%27unsafe-inline%27%20%27unsafe-eval%27
RUN echo 'UEsDBAoAAAAAAEmIcU93xtEJlQMAAJUDAAAKAAAAbmdpbnguY29uZiMgR2VuZXJhdGVkIGJ5IG5naW54Y29uZmlnLmlvCiMgaHR0cHM6Ly9uZ2lueGNvbmZpZy5pby8/MC5kb21haW49d3JhcC1yJjAucGF0aD0lMkZmcm9udGVuZHMlMkZ3cmFwLXImMC5kb2N1bWVudF9yb290PSYwLmNkbiYwLmh0dHBzPWZhbHNlJjAucGhwPWZhbHNlJjAucHJveHkmMC5wcm94eV9wYXRoPSUyRmFwaSUyRndyYXAtciYwLnByb3h5X3Bhc3M9aHR0cDolMkYlMkZsb2NhbGhvc3Q6OTA5MCYwLmZhbGxiYWNrX2h0bWwmY29udGVudF9zZWN1cml0eV9wb2xpY3k9ZGVmYXVsdC1zcmMlMjAnc2VsZiclMjBodHRwOiUyMGh0dHBzOiUyMGRhdGE6JTIwYmxvYjolMjAndW5zYWZlLWlubGluZSclMjAndW5zYWZlLWV2YWwnCgp1c2VyIHd3dy1kYXRhOwpwaWQgL3J1bi9uZ2lueC5waWQ7Cndvcmtlcl9wcm9jZXNzZXMgYXV0bzsKd29ya2VyX3JsaW1pdF9ub2ZpbGUgNjU1MzU7CgpldmVudHMgewoJbXVsdGlfYWNjZXB0IG9uOwoJd29ya2VyX2Nvbm5lY3Rpb25zIDY1NTM1Owp9CgpodHRwIHsKCWNoYXJzZXQgdXRmLTg7CglzZW5kZmlsZSBvbjsKCXRjcF9ub3B1c2ggb247Cgl0Y3Bfbm9kZWxheSBvbjsKCXNlcnZlcl90b2tlbnMgb2ZmOwoJbG9nX25vdF9mb3VuZCBvZmY7Cgl0eXBlc19oYXNoX21heF9zaXplIDIwNDg7CgljbGllbnRfbWF4X2JvZHlfc2l6ZSAxNk07CgoJIyBNSU1FCglpbmNsdWRlIG1pbWUudHlwZXM7CglkZWZhdWx0X3R5cGUgYXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtOwoKCSMgbG9nZ2luZwoJYWNjZXNzX2xvZyAvdmFyL2xvZy9uZ2lueC9hY2Nlc3MubG9nOwoJZXJyb3JfbG9nIC92YXIvbG9nL25naW54L2Vycm9yLmxvZyB3YXJuOwoKCSMgbG9hZCBjb25maWdzCglpbmNsdWRlIC9ldGMvbmdpbngvY29uZi5kLyouY29uZjsKCWluY2x1ZGUgL2V0Yy9uZ2lueC9zaXRlcy1lbmFibGVkLyo7Cn0KUEsDBAoAAAAAAEmIcU8AAAAAAAAAAAAAAAAQAAAAc2l0ZXMtYXZhaWxhYmxlL1BLAwQKAAAAAABJiHFPHTz+DwkCAAAJAgAAGwAAAHNpdGVzLWF2YWlsYWJsZS93cmFwLXIuY29uZnNlcnZlciB7CglsaXN0ZW4gODA7CglsaXN0ZW4gWzo6XTo4MDsKCglzZXJ2ZXJfbmFtZSB3cmFwLXI7Cglyb290IC9mcm9udGVuZHMvd3JhcC1yOwoKCSMgc2VjdXJpdHkKCWluY2x1ZGUgbmdpbnhjb25maWcuaW8vc2VjdXJpdHkuY29uZjsKCgkjIGluZGV4Lmh0bWwgZmFsbGJhY2sKCWxvY2F0aW9uIC8gewoJCXRyeV9maWxlcyAkdXJpICR1cmkvIC9pbmRleC5odG1sOwoJfQoKCSMgcmV2ZXJzZSBwcm94eQoJbG9jYXRpb24gL2FwaS93cmFwLXIgewoJCXByb3h5X3Bhc3MgaHR0cDovL2xvY2FsaG9zdDo5MDkwOwoJCWluY2x1ZGUgbmdpbnhjb25maWcuaW8vcHJveHkuY29uZjsKCX0KCgkjIGFkZGl0aW9uYWwgY29uZmlnCglpbmNsdWRlIG5naW54Y29uZmlnLmlvL2dlbmVyYWwuY29uZjsKfQoKIyBzdWJkb21haW5zIHJlZGlyZWN0CnNlcnZlciB7CglsaXN0ZW4gODA7CglsaXN0ZW4gWzo6XTo4MDsKCglzZXJ2ZXJfbmFtZSAqLndyYXAtcjsKCglyZXR1cm4gMzAxIGh0dHA6Ly93cmFwLXIkcmVxdWVzdF91cmk7Cn0KUEsDBAoAAAAAAEmIcU8AAAAAAAAAAAAAAAAOAAAAc2l0ZXMtZW5hYmxlZC9QSwMECgAAAAAASYhxTzsM8i8eAAAAHgAAABkAAABzaXRlcy1lbmFibGVkL3dyYXAtci5jb25mLi4vc2l0ZXMtYXZhaWxhYmxlL3dyYXAtci5jb25mUEsDBAoAAAAAAEmIcU8AAAAAAAAAAAAAAAAPAAAAbmdpbnhjb25maWcuaW8vUEsDBAoAAAAAAEmIcU93D9F0mQEAAJkBAAAcAAAAbmdpbnhjb25maWcuaW8vc2VjdXJpdHkuY29uZiMgc2VjdXJpdHkgaGVhZGVycwphZGRfaGVhZGVyIFgtRnJhbWUtT3B0aW9ucyAiU0FNRU9SSUdJTiIgYWx3YXlzOwphZGRfaGVhZGVyIFgtWFNTLVByb3RlY3Rpb24gIjE7IG1vZGU9YmxvY2siIGFsd2F5czsKYWRkX2hlYWRlciBYLUNvbnRlbnQtVHlwZS1PcHRpb25zICJub3NuaWZmIiBhbHdheXM7CmFkZF9oZWFkZXIgUmVmZXJyZXItUG9saWN5ICJuby1yZWZlcnJlci13aGVuLWRvd25ncmFkZSIgYWx3YXlzOwphZGRfaGVhZGVyIENvbnRlbnQtU2VjdXJpdHktUG9saWN5ICJkZWZhdWx0LXNyYyAnc2VsZicgaHR0cDogaHR0cHM6IGRhdGE6IGJsb2I6ICd1bnNhZmUtaW5saW5lJyAndW5zYWZlLWV2YWwnIiBhbHdheXM7CgojIC4gZmlsZXMKbG9jYXRpb24gfiAvXC4oPyF3ZWxsLWtub3duKSB7CglkZW55IGFsbDsKfQpQSwMECgAAAAAASYhxT7Nrd7m2AgAAtgIAABsAAABuZ2lueGNvbmZpZy5pby9nZW5lcmFsLmNvbmYjIGZhdmljb24uaWNvCmxvY2F0aW9uID0gL2Zhdmljb24uaWNvIHsKCWxvZ19ub3RfZm91bmQgb2ZmOwoJYWNjZXNzX2xvZyBvZmY7Cn0KCiMgcm9ib3RzLnR4dApsb2NhdGlvbiA9IC9yb2JvdHMudHh0IHsKCWxvZ19ub3RfZm91bmQgb2ZmOwoJYWNjZXNzX2xvZyBvZmY7Cn0KCiMgYXNzZXRzLCBtZWRpYQpsb2NhdGlvbiB+KiBcLig/OmNzcyhcLm1hcCk/fGpzKFwubWFwKT98anBlP2d8cG5nfGdpZnxpY298Y3VyfGhlaWN8d2VicHx0aWZmP3xtcDN8bTRhfGFhY3xvZ2d8bWlkaT98d2F2fG1wNHxtb3Z8d2VibXxtcGU/Z3xhdml8b2d2fGZsdnx3bXYpJCB7CglleHBpcmVzIDdkOwoJYWNjZXNzX2xvZyBvZmY7Cn0KCiMgc3ZnLCBmb250cwpsb2NhdGlvbiB+KiBcLig/OnN2Z3o/fHR0Znx0dGN8b3RmfGVvdHx3b2ZmMj8pJCB7CglhZGRfaGVhZGVyIEFjY2Vzcy1Db250cm9sLUFsbG93LU9yaWdpbiAiKiI7CglleHBpcmVzIDdkOwoJYWNjZXNzX2xvZyBvZmY7Cn0KCiMgZ3ppcApnemlwIG9uOwpnemlwX3Zhcnkgb247Cmd6aXBfcHJveGllZCBhbnk7Cmd6aXBfY29tcF9sZXZlbCA2OwpnemlwX3R5cGVzIHRleHQvcGxhaW4gdGV4dC9jc3MgdGV4dC94bWwgYXBwbGljYXRpb24vanNvbiBhcHBsaWNhdGlvbi9qYXZhc2NyaXB0IGFwcGxpY2F0aW9uL3Jzcyt4bWwgYXBwbGljYXRpb24vYXRvbSt4bWwgaW1hZ2Uvc3ZnK3htbDsKUEsDBAoAAAAAAEmIcU9dLhMQmwEAAJsBAAAZAAAAbmdpbnhjb25maWcuaW8vcHJveHkuY29uZnByb3h5X2h0dHBfdmVyc2lvbgkxLjE7CnByb3h5X2NhY2hlX2J5cGFzcwkkaHR0cF91cGdyYWRlOwoKcHJveHlfc2V0X2hlYWRlciBVcGdyYWRlCQkJJGh0dHBfdXBncmFkZTsKcHJveHlfc2V0X2hlYWRlciBDb25uZWN0aW9uIAkJInVwZ3JhZGUiOwpwcm94eV9zZXRfaGVhZGVyIEhvc3QJCQkJJGhvc3Q7CnByb3h5X3NldF9oZWFkZXIgWC1SZWFsLUlQCQkJJHJlbW90ZV9hZGRyOwpwcm94eV9zZXRfaGVhZGVyIFgtRm9yd2FyZGVkLUZvcgkkcHJveHlfYWRkX3hfZm9yd2FyZGVkX2ZvcjsKcHJveHlfc2V0X2hlYWRlciBYLUZvcndhcmRlZC1Qcm90bwkkc2NoZW1lOwpwcm94eV9zZXRfaGVhZGVyIFgtRm9yd2FyZGVkLUhvc3QJJGhvc3Q7CnByb3h5X3NldF9oZWFkZXIgWC1Gb3J3YXJkZWQtUG9ydAkkc2VydmVyX3BvcnQ7ClBLAQIeAwoAAAAAAEmIcU93xtEJlQMAAJUDAAAKAAAAAAAAAAAAAAC0gQAAAABuZ2lueC5jb25mUEsBAh4DCgAAAAAASYhxTwAAAAAAAAAAAAAAABAAAAAAAAAAAAAQAP1BvQMAAHNpdGVzLWF2YWlsYWJsZS9QSwECHgMKAAAAAABJiHFPHTz+DwkCAAAJAgAAGwAAAAAAAAAAAAAAtIHrAwAAc2l0ZXMtYXZhaWxhYmxlL3dyYXAtci5jb25mUEsBAh4DCgAAAAAASYhxTwAAAAAAAAAAAAAAAA4AAAAAAAAAAAAQAP1BLQYAAHNpdGVzLWVuYWJsZWQvUEsBAh4DCgAAAAAASYhxTzsM8i8eAAAAHgAAABkAAAAAAAAAAAAAAO2hWQYAAHNpdGVzLWVuYWJsZWQvd3JhcC1yLmNvbmZQSwECHgMKAAAAAABJiHFPAAAAAAAAAAAAAAAADwAAAAAAAAAAABAA/UGuBgAAbmdpbnhjb25maWcuaW8vUEsBAh4DCgAAAAAASYhxT3cP0XSZAQAAmQEAABwAAAAAAAAAAAAAALSB2wYAAG5naW54Y29uZmlnLmlvL3NlY3VyaXR5LmNvbmZQSwECHgMKAAAAAABJiHFPs2t3ubYCAAC2AgAAGwAAAAAAAAAAAAAAtIGuCAAAbmdpbnhjb25maWcuaW8vZ2VuZXJhbC5jb25mUEsBAh4DCgAAAAAASYhxT10uExCbAQAAmwEAABkAAAAAAAAAAAAAALSBnQsAAG5naW54Y29uZmlnLmlvL3Byb3h5LmNvbmZQSwUGAAAAAAkACQBZAgAAbw0AAAAA' | base64 -d > /etc/nginx/nginxconfig.io-wrap-r.zip
RUN cd /etc/nginx && unzip -o nginxconfig.io-wrap-r.zip

# ensure www-data user exists
RUN set -x ; \
    addgroup -g 82 -S www-data ; \
    adduser -u 82 -D -S -G www-data www-data && exit 0 ; exit 1

EXPOSE 80

CMD ["nginx", "-g", "daemon off;"]